@inject IRequestSender RequestSender
@using InstanceManager.Application.Contracts.Modules.DataSets
@implements IDialogContentComponent

<RadzenDataGrid @ref="_filesGrid" TItem="UploadedFileDto" Data="@_uploadedFiles" AllowPaging="false" AllowSorting="false">
    <Columns>
        <RadzenDataGridColumn TItem="UploadedFileDto" Property="FileName" Title="File Name" />
        <RadzenDataGridColumn TItem="UploadedFileDto" Title="Actions">
            <Template Context="data">
                <RadzenButton ButtonStyle="ButtonStyle.Primary" Icon="play_arrow" Click="@(() => ProcessFile(data.FileName))" />
            </Template>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>

@code {
    [Parameter]
    public Guid DataSetId { get; set; }

    [Parameter]
    public object Content { get; set; } = null!;

    private RadzenDataGrid<UploadedFileDto> _filesGrid = null!;
    private List<UploadedFileDto> _uploadedFiles = [];

    protected override async Task OnInitializedAsync()
    {
        await LoadUploadedFiles();
    }

    private async Task LoadUploadedFiles()
    {
        _uploadedFiles = await RequestSender.SendAsync(new GetUploadedFilesQuery { DataSetId = DataSetId });
        await _filesGrid.Reload();
    }

    private Task OnUploadComplete(UploadCompleteEventArgs args)
    {
        return Task.CompletedTask;
    }

    private async Task ProcessFile(string? fileName)
    {
        await LoadUploadedFiles();
    }
}
