@page "/translations"
@using InstanceManager.Application.Contracts.Common
@using InstanceManager.Application.Contracts.Modules.Translations
@using Radzen
@using Radzen.Blazor
@using Orientation=Microsoft.FluentUI.AspNetCore.Components.Orientation

<FluentStack Orientation="Orientation.Horizontal" VerticalAlignment="VerticalAlignment.Center">
    <h3 style="margin: 0;">Translations</h3>
    
    <FluentNavLink Href="@NavHelper.BuildUrl("action", "create")">
        <FluentButton Appearance="Appearance.Accent" IconStart="@(new Icons.Regular.Size20.Add())" />
    </FluentNavLink>
</FluentStack>

<FluentDivider Style="margin: 16px 0;" />

<DataLoader TResponse="PaginatedList<TranslationDto>"
            TQuery="GetTranslationsQuery"
            Query="@_currentQuery"
            CacheKey="@_cacheKey"
            RefreshToken="@_refreshToken"
            OnDataFetched="HandleDataFetched">
    <ChildContent Context="result">
        <PaginatedDataGrid TItem="TranslationDto"
                          Items="@AllTranslations"
                          TotalItems="@_totalItems"
                          PageSize="@_pageSize"
                          SearchPlaceholder="Search translations..."
                          @bind-SearchTerm="@_searchTerm"
                          OnSearchChanged="@OnSearchChanged"
                          LoadData="@OnLoadData"
                          SelectedRows="@_selectedRows"
                          SelectedRowsChanged="@OnDataGridSelectionChanged">
            <AdditionalFilters>
                <FluentTextField Placeholder="Filter by culture (e.g., en-US)..."
                                @bind-Value="@_cultureNameFilter"
                                @bind-Value:after="OnCultureFilterChanged"
                                Style="width: 250px;" />
                @if (!string.IsNullOrWhiteSpace(_cultureNameFilter))
                {
                    <FluentButton Appearance="Appearance.Lightweight"
                                  IconStart="@(new Icons.Regular.Size20.Dismiss())"
                                  OnClick="ClearCultureFilter">
                        Clear Culture
                    </FluentButton>
                }
            </AdditionalFilters>
            <Columns>
                <RadzenDataGridColumn TItem="TranslationDto" Property="InternalGroupName" Title="Group" Width="120px" />
                <RadzenDataGridColumn TItem="TranslationDto" Property="ResourceName" Title="Resource" Width="150px" />
                <RadzenDataGridColumn TItem="TranslationDto" Property="TranslationName" Title="Key" Width="150px" />
                <RadzenDataGridColumn TItem="TranslationDto" Property="CultureName" Title="Culture" Width="80px" />
                <RadzenDataGridColumn TItem="TranslationDto" Property="Content" Title="Content">
                    <Template Context="translation">
                        @if (translation.Content.Length > 100)
                        {
                            <text>@translation.Content.Substring(0, 100)...</text>
                        }
                        else
                        {
                            <text>@translation.Content</text>
                        }
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="TranslationDto" Property="CreatedAt" Title="Created At" FormatString="{0:yyyy-MM-dd HH:mm}" Width="150px" />
            </Columns>
        </PaginatedDataGrid>
    </ChildContent>
</DataLoader>
