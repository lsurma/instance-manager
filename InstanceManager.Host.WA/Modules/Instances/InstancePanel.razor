@using InstanceManager.Application.Contracts.Modules.ProjectInstance
@using Orientation=Microsoft.FluentUI.AspNetCore.Components.Orientation
@implements IDialogContentComponent<InstancePanelParameters>

<FluentDialogBody>
    <EditForm Model="Content.Instance" OnSubmit="@(() => HandleSubmitAsync(false))">
        <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
            
            <FluentTextField @bind-Value="Content.Instance.Name"
                             Label="Name"
                             Immediate="true"
                             Required
                             Style="width: 100%;" />
            
            <FluentTextArea @bind-Value="Content.Instance.Description"
                            Label="Description"
                            Immediate="true"
                            Rows="3"
                            Style="width: 100%;" />
            
            <FluentTextField @bind-Value="Content.Instance.MainHost"
                             Label="Main Host"
                             Immediate="true"
                             Placeholder="e.g., localhost:5000"
                             Style="width: 100%;" />
            
            <FluentTextArea @bind-Value="Content.Instance.Notes"
                            Label="Notes"
                            Immediate="true"
                            Rows="4"
                            Style="width: 100%;" />
            
            @if (Content.AvailableParentInstances.Any())
            {
                <FluentSelect Value="@(Content.Instance.ParentProjectId.ToString())"
                              ValueChanged="@((val) => Content.Instance.ParentProjectId = String.IsNullOrWhiteSpace(val) ? null : Guid.Parse(val))"
                              Label="Parent Project (Optional)"
                              Items="ParentSelectItems"
                              OptionValue="@(opt => opt.Value.ToString())"
                              Style="width: 100%;">
                    <OptionTemplate Context="optionTemplateContext">
                        @optionTemplateContext.Text
                    </OptionTemplate>
                </FluentSelect>
            }
            
            @if (!string.IsNullOrEmpty(ErrorMessage))
            {
                <FluentMessageBar Intent="MessageIntent.Error">
                    @ErrorMessage
                </FluentMessageBar>
            }
            
        </FluentStack>
    </EditForm>
</FluentDialogBody>

    <EntityPanelFooter IsEditMode="@Content.IsEditMode"
                          IsSaving="@IsSaving"
                          IsDeleting="@IsDeleting"
                          OnSave="@(() => HandleSubmitAsync(closeAfterSave: false))"
                          OnSaveAndClose="@(() => HandleSubmitAsync(closeAfterSave: true))"
                          OnCancel="@HandleCancelAsync"
                          OnDelete="@HandleDeleteClickAsync" />
